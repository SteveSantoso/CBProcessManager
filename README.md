# CB 进程管理软件

一款基于 **Win32 + WebView2** 的轻量级 Windows 进程管理工具，内嵌 Vue 3 + Element Plus 现代化界面，支持一键启动/停止、进程守护、延迟启动、运行日志等功能。

---

## 功能特性

| 功能 | 说明 |
|---|---|
| 启动 / 停止 | 支持 `.exe` 和 `.bat` 两种类型 |
| 进程守护 | 进程意外崩溃后自动重启，可设延迟秒数 |
| 延迟启动 | 程序启动后等待 N 秒再拉起进程 |
| PID 显示 | bat 类型自动探测实际子进程 PID |
| 一键全启 / 全停 | 顶部按钮批量操作所有已启用进程 |
| 开机自动启动 | 配置项控制软件打开时自动启动全部进程 |
| 运行日志 | 每次运行生成独立日志文件，记录启停/异常/错误原因 |
| 系统托盘 | 关闭窗口后最小化到托盘，双击恢复 |
| 单实例保护 | 重复打开时弹窗提示，不会启动多个实例 |

---

## 运行环境

- **操作系统**：Windows 10 / 11（x64）
- **运行库**：[Microsoft Edge WebView2 运行时](https://developer.microsoft.com/zh-cn/microsoft-edge/webview2/)（大多数 Win10/11 已内置）

---

## 快速开始

### 1. 下载

前往 [Releases](../../releases) 页面下载最新版本压缩包，解压到任意目录。

目录结构如下：

```
CB进程管理软件/
├── ProcessManager.exe   ← 主程序
├── config.json          ← 配置文件
├── html/                ← 界面资源（勿删）
└── logs/                ← 运行日志（自动生成）
```

### 2. 启动程序

双击 `ProcessManager.exe` 即可。

---

## 界面说明

### 顶部工具栏

| 按钮 | 功能 |
|---|---|
| 全部启动 | 启动所有「已启用」的进程 |
| 全部停止 | 停止所有正在运行的进程 |
| 添加进程 | 打开对话框新增一条进程配置 |

运行中进程数量会以绿色标签实时显示在顶部。

### 进程列表列说明

| 列 | 说明 |
|---|---|
| 状态指示点 | 绿色=运行中，灰色=已停止，橙色=启动中，蓝色=重启中，红色=启动失败 |
| 名称 | 进程自定义名称 |
| 路径 | 可执行文件或 bat 脚本完整路径 |
| 类型 | `exe` 或 `bat` |
| 延迟 | 启动延迟秒数（0 表示立即启动） |
| 守护 | 是否启用崩溃自重启 |
| 状态 | 文字状态标签 |
| PID | 进程 ID（bat 类型显示实际子进程 PID） |
| 操作 | 启动/停止、编辑、删除 |

### 状态说明

| 状态 | 含义 |
|---|---|
| 运行中 | 进程正常运行 |
| 已停止 | 进程未运行 |
| 启动中 | 正在启动或等待延迟 |
| 重启中 | 崩溃后等待守护重启 |
| **启动失败** | 路径错误、文件不存在等原因导致无法启动，查看日志获取详细原因 |

---

## 添加进程

点击右上角「**+ 添加进程**」按钮，填写以下信息：

| 字段 | 说明 |
|---|---|
| 进程名称 | 自定义显示名称 |
| 类型 | 选择 `exe`（可执行程序）或 `bat`（批处理脚本） |
| 文件路径 | 填写完整绝对路径，或点击输入框右侧图标浏览（如支持） |
| 启动参数 | 命令行参数，可留空 |
| 启动延迟 | 秒数，0 = 立即启动 |
| 进程守护 | 开关打开后崩溃自动重启 |
| 守护延迟 | 重启前等待秒数（默认 1 秒） |
| 启用 | 关闭后「全部启动」将跳过此进程 |

> **提示**：bat 脚本路径含中文或空格均可正常使用，工作目录自动设置为 bat 文件所在目录。

---

## 配置文件 config.json

程序运行目录下的 `config.json` 存储所有配置，**程序未运行时**可以直接编辑。

```json
{
  "autoStartOnOpen": true,
  "processes": [
    {
      "id": "自动生成的UUID",
      "name": "我的程序",
      "path": "C:\\MyApp\\app.exe",
      "type": "exe",
      "args": "--port 8080",
      "delaySeconds": 0,
      "guardEnabled": true,
      "guardDelaySeconds": 1,
      "enabled": true
    }
  ]
}
```

| 字段 | 类型 | 说明 |
|---|---|---|
| `autoStartOnOpen` | bool | 软件启动时是否自动拉起所有已启用进程 |
| `name` | string | 显示名称 |
| `path` | string | 完整文件路径（注意 JSON 中反斜杠需写成 `\\`） |
| `type` | string | `"exe"` 或 `"bat"` |
| `args` | string | 启动参数，可为空字符串 |
| `delaySeconds` | int | 延迟启动秒数 |
| `guardEnabled` | bool | 是否启用崩溃守护 |
| `guardDelaySeconds` | int | 守护重启延迟秒数 |
| `enabled` | bool | 是否参与「全部启动」 |

> ⚠️ **注意**：修改 `config.json` 前请先关闭程序，否则保存时可能被覆盖。

---

## 运行日志

每次启动程序在 `logs/` 目录生成一个新日志文件，命名格式：

```
logs/pm_20260219_143000.log
```

日志包含：

- 程序启动时间和版权信息
- WebView2 界面初始化状态
- 每个进程的启动命令、PID、停止、退出码
- **启动失败时的详细原因**（如：`系统找不到指定的文件`）
- 守护重启记录

**常见启动失败原因：**

| 错误 | 原因 |
|---|---|
| 系统找不到指定的文件 | 路径中的文件名拼写错误 |
| 系统找不到指定的路径 | 目录不存在 |
| 拒绝访问 | 需要管理员权限运行 |

---

## 系统托盘

- 点击窗口关闭按钮 → 最小化到系统托盘（程序继续运行）
- **双击托盘图标** → 恢复窗口
- **右键托盘图标** → 显示菜单（显示窗口 / 退出）

选择「退出」会停止所有进程并完全退出程序。

---

## 常见问题

**Q：程序打不开 / 白屏**  
A：请安装 [WebView2 运行时](https://developer.microsoft.com/zh-cn/microsoft-edge/webview2/)，下载"常青版独立安装程序"。

**Q：bat 脚本启动后 PID 显示不正确**  
A：bat 启动后约 1~5 秒内 PID 会自动更新为实际子进程 PID，稍等片刻即可。

**Q：进程状态显示「启动失败」（红色）**  
A：查看 `logs/` 目录中最新的日志文件，找到「启动失败」行，原因已用中文说明。常见原因是路径填写错误。

**Q：停止按钮按了没反应**  
A：程序使用 Job Object 机制强制终止整个进程树，若进程有特殊保护机制可能需要以管理员身份运行本软件。

---

## 开发信息

| 项目 | 说明 |
|---|---|
| 开发语言 | C++17 / JavaScript (Vue 3) |
| UI 框架 | WebView2 + Vue 3 + Element Plus |
| 构建工具 | Visual Studio 2022+ / MSBuild |
| 目标平台 | Windows x64 |
